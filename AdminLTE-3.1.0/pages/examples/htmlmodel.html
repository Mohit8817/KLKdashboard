<!DOCTYPE html>
<html lang="hi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Select Modal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
  <!-- Trigger Button -->
  <button type="button" class="btn btn-primary btn-lg d-block mx-auto my-3" data-bs-toggle="modal"
    data-bs-target="#addDocumentModal">
    Open Document Form
  </button>

  <!-- Modal -->
  <div class="modal fade" id="addDocumentModal" tabindex="-1" aria-labelledby="addDocumentModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="DocumentForm" method="POST" enctype="multipart/form-data">
          <input type="hidden" name="id" id="docid">
          <input type="hidden" name="site_name" id="docinstitute_name">

          <div class="modal-header">
            <h5 class="modal-title" id="documentModalTitle">Add Document</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="row mb-3">
              <div class="col-12 col-md-4 mb-3 mb-md-0">
                <label for="month_year" class="form-label">Select Month and Year</label>
                <input type="month" id="month_year" name="month_year" class="form-control" required>
              </div>
              <div class="col-12 col-md-4 mb-3 mb-md-0">
                <label for="reading" class="form-label">Reading</label>
                <input type="text" id="reading" name="reading" class="form-control" required>
              </div>
              <div class="col-12 col-md-4 mb-3 mb-md-0">
                <label for="bill_no" class="form-label">Bill No</label>
                <input type="text" id="bill_no" name="bill_no" class="form-control" required>
              </div>
            </div>

            <div class="mt-3">
              <h6 class="mb-3">Inverter Details</h6>
              <div id="inverter-container">
                <div class="row mb-3 inverter-row">
                  <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Inverter No</label>
                    <select name="inverter_no[]" class="form-control inverter_no" required>
                      <option value="" selected disabled>Select Inverter</option>
                      <option value="1">Inverter 1</option>
                      <option value="2">Inverter 2</option>
                      <option value="3">Inverter 3</option>
                    </select>
                  </div>
                  <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Previous Current</label>
                    <input type="number" name="previous_current[]" class="form-control" step="0.01">
                  </div>
                  <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Current Reading</label>
                    <input type="number" name="current_previous[]" class="form-control" step="0.01" required>
                  </div>
                  <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Unit Generated</label>
                    <input type="number" name="unit_generated[]" class="form-control" step="0.01" required>
                  </div>
                  <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Select a file</label>
                    <input type="file" class="form-control" name="myfile[]">
                  </div>
                </div>
              </div>

              <!-- Buttons -->
              <div class="mt-3">
                <button type="button" class="btn btn-primary btn-sm" id="addInverter">
                  <span>+</span> Add More
                </button>
                <button type="button" class="btn btn-danger btn-sm" id="removeInverter">
                  <span>-</span> Remove
                </button>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" id="documentModalSubmit" class="btn btn-success">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Set max date for month input to current month
    // const today = new Date();
    // const maxDate = today.toISOString().slice(0, 7);
    // document.getElementById('month_year').setAttribute('max', maxDate);

    // Add new inverter row
    document.getElementById('addInverter').addEventListener('click', function () {
      const container = document.getElementById('inverter-container');
      const newRow = document.createElement('div');
      newRow.classList.add('row', 'mb-3', 'inverter-row');
      newRow.innerHTML = `
                <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Inverter No</label>
                    <select name="inverter_no[]" class="form-control inverter_no" required>
                        <option value="" selected disabled>Select Inverter</option>
                        <option value="1">Inverter 1</option>
                        <option value="2">Inverter 2</option>
                        <option value="3">Inverter 3</option>
                    </select>
                </div>
                <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Previous Current</label>
                    <input type="number" name="previous_current[]" class="form-control" step="0.01">
                </div>
                <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Current Reading</label>
                    <input type="number" name="current_previous[]" class="form-control" step="0.01" required>
                </div>
                <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Unit Generated</label>
                    <input type="number" name="unit_generated[]" class="form-control" step="0.01" required>
                </div>
                <div class="col-12 col-md mb-3 mb-md-0">
                    <label class="form-label">Select a file</label>
                    <input type="file" class="form-control" name="myfile[]">
                </div>
            `;
      container.appendChild(newRow);
    });

    // Remove last inverter row
    document.getElementById('removeInverter').addEventListener('click', function () {
      const container = document.getElementById('inverter-container');
      const rows = container.getElementsByClassName('inverter-row');
      if (rows.length > 1) {
        container.removeChild(rows[rows.length - 1]);
      } else {
        alert('At least one inverter row is required!');
      }
    });

    // // Form submission
    // document.getElementById('DocumentForm').addEventListener('submit', function(e) {
    //     e.preventDefault();

    //     // Collect form data
    //     const formData = new FormData(this);
    //     const data = {};

    //     formData.forEach((value, key) => {
    //         if (data[key]) {
    //             if (Array.isArray(data[key])) {
    //                 data[key].push(value);
    //             } else {
    //                 data[key] = [data[key], value];
    //             }
    //         } else {
    //             data[key] = value;
    //         }
    //     });

    //     console.log('Form Data:', data);
    //     alert('Form submitted successfully! Check console for data.');

    //     // Here you would normally send the data to your server
    //     // fetch('/your-endpoint', {
    //     //     method: 'POST',
    //     //     body: formData
    //     // });
    // });
  </script>
</body>

</html>
